import molecularmatch_trials
import json
from collections import namedtuple
import evidence_label as el


EVIDENCE = json.loads("""
{"status": "Recruiting", "startDate": "June 2016", "title": "Hyperpolarized Xenon-129 Functional Magnetic Resonance Imaging of Healthy Volunteers and Participants With Alzheimer's Disease", "molecularAlterations": [], "_score": -7, "interventions": [{"intervention_name": "Traditional Proton fMRI", "description": "Conventional proton fMRI will be performed. During the functional imaging acquisitions, the participant will be asked by the research team to perform simple tasks. These tasks will be completed while the participant breathes air (normal breathing).", "arm_group_label": ["Healthy Volunteers", "Alzheimer's Disease Participants"], "intervention_type": "Other"}, {"intervention_name": "Hyperpolarized Xenon-129 fMRI", "other_name": "HP 129Xe fMRI", "description": "HP 129Xe fMRI data will be acquired from all participants. Hyperpolarized xenon (NeuroXene) is expected to produce images that provide more clinically relevant information than traditional proton scans. Simple tasks will be performed by participants while breathing NeuroXene according to several inhalation procedures.", "arm_group_label": ["Healthy Volunteers", "Alzheimer's Disease Participants"], "intervention_type": "Other"}, {"intervention_name": "Hyperpolarized Xenon-129", "other_name": "NeuroXene", "description": "Participants will be asked to inhale specified amounts of NeuroXene according to several inhalation procedures. NeuroXene is the trade name for hyperpolarization of xenon-129 balanced with oxygen and nitrogen using a Xemed LLC polarizer. Hyperpolarization does not change the chemical or physical properties of xenon gas.", "arm_group_label": ["Healthy Volunteers", "Alzheimer's Disease Participants"], "intervention_type": "Drug"}, {"intervention_name": "1H-129Xe Dual-Tuned Quadrature Head Coil", "description": "A 1H-129Xe dual-tuned quadrature head coil (Clinical MR Solutions, LLC) will be used in this study. The RF coil will be used to acquire MRI images of the human brain after inhalation of hyperpolarized xenon-129 gas, and permits the acquisition of both conventional proton and HP xenon gas images.", "arm_group_label": ["Healthy Volunteers", "Alzheimer's Disease Participants"], "intervention_type": "Device"}], "locations": [{"status": "Recruiting", "city": "Thunder Bay", "last_name": "Mitchell S Albert, PhD", "phone_backup": "807-684-6958", "zip": "P7B 6V4", "country": "Canada", "last_name_backup": "Jennifer Plata, HBSc", "email": "albertmi@tbh.net", "phone": "807-684-7270", "state": "Ontario", "email_backup": "plataj@tbh.net", "geo": {"lat": 48.416, "lon": -89.267}, "id": "thunderbayregionalhealthsciencescentre_thunderbay_ontario_ca_p7b6v4", "name": "Thunder Bay Regional Health Sciences Centre"}], "briefTitle": "HP Xenon-129 fMRI of Healthy Volunteers and Participants With Alzheimer's Disease", "overallContact": {"phone": "807-684-7270", "last_name": "Mitchell Albert, Ph.D.", "email": "albertmi@tbh.net"}, "phase": "Early Phase 1", "tags": [{"facet": "DRUG", "compositeKey": "Oxygen compressedDRUGinclude", "suppress": false, "filterType": "include", "term": "Oxygen compressed", "custom": false, "priority": 1, "alias": "Oxygen compressed"}, {"facet": "DRUG", "compositeKey": "NitrogenDRUGinclude", "suppress": false, "filterType": "include", "term": "Nitrogen", "custom": false, "priority": 1, "alias": "Nirtogen"}, {"facet": "DRUG", "compositeKey": "Xenon xe-133DRUGinclude", "suppress": false, "filterType": "include", "term": "Xenon xe-133", "custom": false, "priority": 1, "alias": "Xenon xe-133"}, {"facet": "DRUGCLASS", "compositeKey": "Inhalation Diagnostic AgentDRUGCLASSinclude", "suppress": false, "generatedBy": "DRUG", "filterType": "include", "term": "Inhalation Diagnostic Agent", "custom": false, "priority": 0, "alias": "Inhalation Diagnostic Agent", "generatedByTerm": "Xenon xe-133"}, {"facet": "DRUGCLASS", "compositeKey": "Radiopharmaceutical ActivityDRUGCLASSinclude", "suppress": false, "generatedBy": "DRUG", "filterType": "include", "term": "Radiopharmaceutical Activity", "custom": false, "priority": 0, "alias": "Radiopharmaceutical Activity", "generatedByTerm": "Xenon xe-133"}, {"facet": "DRUG", "compositeKey": "NirtogenDRUGinclude", "suppress": false, "filterType": "include", "term": "Nirtogen", "custom": false, "priority": 1, "alias": "Nirtogen"}, {"facet": "CONDITION", "compositeKey": "DementiaCONDITIONexclude", "suppress": false, "filterType": "exclude", "term": "Dementia", "custom": false, "priority": 1, "alias": "Dementia"}, {"facet": "CONDITION", "compositeKey": "Infective disorderCONDITIONexclude", "suppress": false, "filterType": "exclude", "term": "Infective disorder", "custom": false, "priority": 1, "alias": "Infection"}, {"facet": "PHASE", "compositeKey": "Phase 1PHASEinclude", "suppress": false, "filterType": "include", "term": "Phase 1", "custom": false, "priority": 1, "alias": "Phase 1"}, {"facet": "CONDITION", "compositeKey": "AD - Alzheimer's diseaseCONDITIONinclude", "suppress": false, "filterType": "include", "term": "AD - Alzheimer's disease", "custom": false, "priority": 1, "alias": "AD - Alzheimer's disease"}, {"facet": "SITE", "compositeKey": "CerebralSITEinclude", "suppress": false, "generatedBy": "CONDITION", "filterType": "include", "term": "Cerebral", "custom": false, "priority": 0, "alias": "Cerebral", "generatedByTerm": "AD - Alzheimer's disease"}, {"facet": "FINDING", "compositeKey": "Pregnancy confirmedFINDINGexclude", "suppress": false, "filterType": "exclude", "term": "Pregnancy confirmed", "custom": false, "priority": 1, "alias": "Pregnant"}, {"facet": "GENE", "compositeKey": "HPGENEinclude", "suppress": false, "filterType": "include", "term": "HP", "custom": false, "priority": 1, "alias": "HP"}, {"facet": "GENE", "compositeKey": "PTPRFGENEinclude", "suppress": false, "filterType": "include", "term": "PTPRF", "custom": false, "priority": 2, "alias": "PTPRF"}, {"facet": "STATUS", "compositeKey": "RecruitingSTATUSinclude", "suppress": false, "filterType": "include", "term": "Recruiting", "custom": false, "priority": 1, "alias": "Recruiting"}, {"facet": "TRIALTYPE", "compositeKey": "DiagnosticTRIALTYPEinclude", "suppress": false, "filterType": "include", "term": "Diagnostic", "custom": false, "priority": 1, "alias": "Diagnostic"}, {"facet": "TRIALTYPE", "compositeKey": "InterventionalTRIALTYPEinclude", "suppress": false, "filterType": "include", "term": "Interventional", "custom": false, "priority": 1, "alias": "Interventional"}], "id": "NCT02638519", "studyType": "Interventional"}
""")  # NOQA


def convert(dictionary):
    return namedtuple('GenericDict', dictionary.keys())(**dictionary)


def test_convert_association():
    # convert returns a generator
    evidences = list(molecularmatch_trials.convert(EVIDENCE))
    evidence = convert(evidences[0])
    association = convert(evidence.association)
    assert association.evidence_label == 'C'


def test_convert_association2():
    # convert returns a generator
    association = {}
    evidence = {'phase': 'Phase 3'}
    association = el.evidence_label(evidence['phase'],
                                    association, na=False)

    assert association['evidence_label'] == 'B'
